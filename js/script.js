
var mainApp=angular.module('mainApp',["ngAnimate","ui.router"]).config(function($stateProvider,$urlRouterProvider){$stateProvider.state('games',{url:'/games',templateUrl:'views/games/categoriesList.html',controller:'categories',controllerAs:'categories'}).state('games.themes',{url:'/themes',templateUrl:'views/games/themes.html',controller:'themesCtrl',controllerAs:'themes'}).state('games.memory',{url:'/memory',templateUrl:'views/games/memory.html',controller:'memoryCtrl',controllerAs:'memory'}).state('games.attention',{url:'/attention',templateUrl:'views/games/attention.html',controller:'attentionCtrl',controllerAs:'attention'}).state('games.intellection',{url:'/intellection',templateUrl:'views/games/intellection.html',controller:'intellectionCtrl',controllerAs:'intellection'}).state('contact',{url:'/contact',templateUrl:'views/contact.html'}).state('donates',{url:'/donates',templateUrl:'views/donates.html'}).state('about',{url:'/about',templateUrl:'views/about.html',controller:'aboutCtrl',controllerAs:'about'});$urlRouterProvider.otherwise('/games/themes');});mainApp.controller('mainCtrl',function($scope,$interval,Preloader){var main=this;var mainScope=$scope;var changeOptions;var isAges=false;var isThemes=false;$scope.$on('themes',function(event,show,id){var sprite='/games/img/'+id+'/Slider/items.png';var picsArr=[];picsArr.push(sprite);main.showSliderContainer=show;main.showLoading=true;var promiseObj=Preloader.preloadPictures(picsArr);promiseObj.then(function(){main.showLoading=false;main.showSlider=show;mainScope.id=id;main.sprite='url('+sprite+')';});});$scope.$on('intervals',function(event,sound,interval,soundInterval){main.sound=sound;main.interval=interval;main.soundInterval=soundInterval;});this.closeSlider=function(){main.showSlider=false;main.showSliderContainer=false;$interval.cancel(main.interval);$interval.cancel(main.soundInterval);main.sound.pause();};$scope.$on('themesLoading',function(event,show){main.showThemesLoading=show;});$scope.$on('gameOptions',function(event,show,id){main.showGame=show;mainScope.id=id;});$scope.$on('showOptions',function(event,value){changeOptions=value.toString(2);goToOptions();});$scope.$on('agesAndThemes',function(event,ages,themes){isAges=ages;isThemes=themes;});this.closeGame=function(){main.showGame=false;mainScope.ages=false;mainScope.themes=false;};this.backStep=function(){var shiftedValue;var value=parseInt(changeOptions,2);if((value===1&&!isThemes)||(value===2&&!isAges)){shiftedValue=value<<2;}else{shiftedValue=value<<1;}
changeOptions=shiftedValue.toString(2);if(changeOptions.length>3){main.closeGame();}else{goToOptions();}};function goToOptions(){while(changeOptions.length!==3){changeOptions=0+changeOptions;}
mainScope.ages=+changeOptions[0];mainScope.themes=+changeOptions[1];mainScope.showSelectedGame=+changeOptions[2];}});mainApp.controller('navbar',function($http){var _this=this;this.showMobileItems=false;$http.get('data/nav.json').success(function(data){_this.items=data;});this.showMobileMenu=function(){if(window.innerWidth>914){return}
_this.showMobileItems=!_this.showMobileItems;}});mainApp.controller('categories',function($http){var _this=this;this.showMobileChapters=false;$http.get('data/categories.json').success(function(data){_this.items=data;});this.showChapters=function(){if(window.innerWidth>914){return}
_this.showMobileChapters=!_this.showMobileChapters;}});mainApp.controller('themesCtrl',function($scope,Loader){var themes=$scope;var showSliderBg=false;Loader.loadPics('/data/themes.json',themes,'/games/img/strToReplace/themePicture.svg');$scope.showBg=function(id){showSliderBg=true;themes.$emit('themes',showSliderBg,id);};});mainApp.controller('memoryCtrl',function($scope,$http,$timeout){var memory=$scope;var showGameBg=false;memory.showListLoading=true;$timeout(function(){$http.get('/data/memory.json').success(function(data){memory.showListLoading=false;memory.data=data;});},300);$scope.showBg=function(id){showGameBg=true;memory.$emit('gameOptions',showGameBg,id);};});mainApp.controller('attentionCtrl',function($scope,$http,$timeout){var attention=$scope;var showGameBg=false;attention.showListLoading=true;$timeout(function(){$http.get('/data/attention.json').success(function(data){attention.showListLoading=false;attention.data=data;});},300);$scope.showBg=function(id){showGameBg=true;attention.$emit('gameOptions',showGameBg,id);};});mainApp.controller('intellectionCtrl',function($scope,$http,$timeout){var intellection=$scope;var showGameBg=false;intellection.showListLoading=true;$timeout(function(){$http.get('/data/intellection.json').success(function(data){intellection.showListLoading=false;intellection.data=data;});},300);$scope.showBg=function(id){showGameBg=true;intellection.$emit('gameOptions',showGameBg,id);};});mainApp.controller('aboutCtrl',function($http){var _this=this;$http.get('/data/about.json').success(function(data){_this.data=data})});mainApp.controller('progressBarCtrl',function($scope,$interval){var _this=this;var left=0;_this.left=left+'%';var interval=null;this.show=true;this.showOnEvent=false;this.showOnLoad=function(){move();};$scope.$on('showProgressBar',function(event,show){_this.showOnEvent=show;move();});function move(){$interval.cancel(interval);interval=$interval(function(){left+=100*50/$scope.time;_this.left=left+'%';if(left>100||!$scope.showSelectedGame){$interval.cancel(interval);_this.show=false;_this.showOnEvent=false;}},50)}});mainApp.directive('categorieslist',function(){return{restrict:'E',templateUrl:'views/categoriesList.html',controller:'categories',controllerAs:'categories'}});mainApp.directive("gameslist",function(){return{restrict:'E',templateUrl:"views/games/gamesList.html",transclude:true,replace:true}});mainApp.directive('navbar',function(){return{restrict:'E',replace:true,templateUrl:'views/navbar.html',controller:'navbar',controllerAs:'nav'}});mainApp.filter('mpPicsFilter',function(){return function(items,level){var arr=[];if(items){for(var i=0;i<items.length;i++){if(items[i].age.indexOf(level)!==-1){arr.push(items[i]);}}}
return arr}});mainApp.filter('lowerCase',function(){return function(items){return items.map(function(item){return item.toLowerCase();})}});mainApp.directive('slider',function(){return{restrict:'E',templateUrl:'/views/games/slider.html',controller:'sliderCtrl',controllerAs:'slider'}});mainApp.controller('sliderCtrl',function($scope,$http,$interval){document.getElementById('slider').style.backgroundImage='url(/games/img/'+$scope.id+'/themeBg.jpg)';var _this=this;var interval=null;var soundInterval=null;var sound=document.querySelector('audio');var sliderScope=$scope;_this.choosedImageBgPosition='0px 0px';_this.index=0;_this.itemNames=[];_this.sounds='/games/img/'+$scope.id+'/Slider/sounds.mp3';$http.get('/games/img/'+$scope.id+'/Slider/items.json').success(function(data){_this.data=data;_this.itemName=data.soundItems[0].itemName;angular.forEach(data.soundItems,function(item){_this.itemNames.push(item.itemName);});_this.activeClassesArr=new Array(data.soundItems.length);_this.activeClassesArr[_this.index]=1;_this.start();});this.chooseImage=function(index,name){_this.stop();_this.activeClassesArr[_this.index]=0;_this.index=index;_this.activeClassesArr[_this.index]=1;_this.choosedImageBgPosition=-index*300+'px'+' 0px';_this.itemName=name;_this.start();};_this.stop=function(){$interval.cancel(interval);};_this.start=function(){_this.playSounds();interval=$interval(function(){_this.activeClassesArr[_this.index]=0;_this.index++;if(_this.index===_this.itemNames.length){_this.index=0;}
_this.activeClassesArr[_this.index]=1;_this.choosedImageBgPosition=-_this.index*300+'px'+' 0px';_this.itemName=_this.itemNames[_this.index];_this.playSounds();},5000);};this.playSounds=function(){sound.currentTime=_this.data.soundItems[_this.index].begin-0.4;sound.play();window.onblur=function(){$interval.cancel(interval);$interval.cancel(soundInterval);sound.pause();};$interval.cancel(soundInterval);soundInterval=$interval(function(){sliderScope.$emit('intervals',sound,interval,soundInterval);if(sound.currentTime>_this.data.soundItems[_this.index].end){sound.pause();$interval.cancel(soundInterval);}},300);};});mainApp.directive('game',function(){return{restrict:'E',templateUrl:"/views/games/game.html",controller:'gameCtrl',controllerAs:'game'}});mainApp.controller('gameCtrl',function($scope,$http,$compile,$timeout,CustomDirective,Preloader){var _this=this;var game=$scope;var agesColors=['#FF2480','#FF9D2A','#00D36F'];var showThemesLoading=false;this.showLoading=false;this.showPlayAgainBtn=false;this.gamedir=$scope.id.toLowerCase();themesLoading();$http.get('/games/'+$scope.id+'/data/'+$scope.id+'.json').success(function(data){if(data.gameThemes){var picsArr=data.gameThemes.map(function(pic){return'/games/img/'+pic.id+'/themePicture.svg'});angular.forEach(data.gameThemes,function(item,i){item.pic=picsArr[i]});var promiseObj=Preloader.preloadPictures(picsArr);promiseObj.then(function(){themesLoading();if(data.ages){_this.changeGameOptions(4);}else if(data.gameThemes&&data.gameThemes.length>1){_this.changeGameOptions(2);}else{_this.startGame();}
game.agesCategories=data.ages;angular.forEach(game.agesCategories,function(item,index){item.color=agesColors[index];});game.gameThemes=data.gameThemes;game.$emit('agesAndThemes',!!data.ages,!!data.gameThemes);})}});function themesLoading(){showThemesLoading=!showThemesLoading;game.$emit('themesLoading',showThemesLoading);}
this.chooseAge=function(ageSettings){game.ageSettings=ageSettings;if(game.gameThemes&&game.gameThemes.length>1){_this.changeGameOptions(2);}else{if(game.gameThemes){game.themeSettings=game.gameThemes[0]}
_this.startGame();}};this.chooseTheme=function(themeSettings){game.themeSettings=themeSettings;_this.changeGameOptions(0);_this.startGame();};this.changeGameOptions=function(val){game.$emit('showOptions',val);};this.startGame=function(){var trigger=false;_this.showPlayAgainBtn=true;var picsArr=[];if(game.themeSettings.pictures){picsArr=game.themeSettings.pictures.map(function(pic){return'/games/img/'+game.themeSettings.id+'/'+$scope.id+'/'+pic;});picsArr.push('/games/img/'+game.themeSettings.id+'/themeBg.jpg');}
var promiseObj=Preloader.preloadPictures(picsArr);$timeout(function(){if(!trigger){_this.showLoading=true;}},100);promiseObj.then(function(){trigger=true;_this.showLoading=false;_this.changeGameOptions(1);document.getElementById('single-game-container').innerHTML='';document.getElementById('game').style.backgroundImage='url(/games/img/'+game.themeSettings.id+'/themeBg.jpg)';CustomDirective.add(_this.gamedir,document.getElementById('single-game-container'),game);});}});mainApp.directive('age',function(){return{restrict:'E',templateUrl:'/views/game_settings/choose_age.html'}});mainApp.directive('theme',function(){return{restrict:'E',templateUrl:'/views/game_settings/choose_theme.html'}});mainApp.directive('cup',function(){return{restrict:'E',templateUrl:'/views/game_settings/cup.html'}});mainApp.directive('face',function(){return{restrict:'E',templateUrl:'/views/game_settings/face.html'}});mainApp.directive('sounds',function(){return{restrict:'E',templateUrl:'/views/game_settings/sounds.html',controller:'soundsCtrl'}});mainApp.directive('progressbar',function(){return{restrict:'E',templateUrl:'/views/game_settings/progress_bar.html',controller:'progressBarCtrl',controllerAs:'progBar'}});mainApp.service('RandomIndexes',function(){var _this=this;this.buildIndexes=function(min,max,length){var arr=[];for(var i=min;i<max;i++){arr.push(i);}
arr.sort(_this.compareRandom);if(length){arr.length=length;}
return arr;};this.compareRandom=function(a,b){return Math.random()-0.5;};this.makeDouble=function(arrToDouble){var doubledArr=arrToDouble.concat(arrToDouble);doubledArr.sort(_this.compareRandom);return doubledArr;};this.randInteger=function(min,max){var rand;rand=min+Math.random()*(max+1-min);rand=Math.floor(rand);return rand;}});mainApp.service('CustomDirective',function($compile){this.add=function(dirName,parentElem,scope){var dir='<'+dirName+'></'+dirName+'>';var dirCompiled=$compile(dir)(scope);angular.element(parentElem).append(dirCompiled);}});mainApp.service('GameSounds',function(){var rightSound;var errorSound;var winnerSound;var gameOverSound;this.defineRightSound=function(sound){rightSound=sound;};this.defineErrorSound=function(sound){errorSound=sound;};this.defineWinnerSound=function(sound){winnerSound=sound;};this.defineGameOverSound=function(sound){gameOverSound=sound;};this.playRightSound=function(){rightSound.volume=0.2;rightSound.currentTime=0;rightSound.play();};this.playErrorSound=function(){errorSound.volume=0.2;errorSound.currentTime=0;errorSound.play();};this.playWinnerSound=function(){winnerSound.volume=0.2;winnerSound.play();};this.playGameOverSound=function(){gameOverSound.volume=0.2;gameOverSound.play();};});mainApp.service('Preloader',function($http,$q){this.preloadPictures=function(pics){var deferred=$q.defer();if(!pics.length){deferred.resolve();return deferred.promise;}else{var imagesLoaded=0;var imgs=[];for(var i=0;i<pics.length;i++){imgs[i]=new Image();imgs[i].src=pics[i];imgs[i].onload=function(){imagesLoaded++;checkIsLoaded(imagesLoaded,pics.length);}}
return deferred.promise;}
function checkIsLoaded(imgsLoaded,total){if(imgsLoaded===total){deferred.resolve();}}};});mainApp.service('Loader',function($http,$timeout,Preloader){var _this=this;this.loadPics=function(path,scope,template){_this.trigger=false;$timeout(function(){if(!_this.trigger){scope.showListLoading=true;}},10);$http.get(path).success(function(data){_this.buildPicsArr(data,scope,template);});};this.buildPicsArr=function(data,scope,template){var pics=data.map(function(pic){return _this.buildPath(template,pic.id)});_this.preloadPics(pics,data,scope);};this.buildPath=function(template,str){return template.replace('strToReplace',str)};this.preloadPics=function(pics,data,scope){var promiseObj=Preloader.preloadPictures(pics);promiseObj.then(function(){scope.data=data;angular.forEach(scope.data,function(item,i){item.pic=pics[i]});_this.trigger=true;scope.showListLoading=false;});}});mainApp.service('DragManager',function(){var _this=this;var dragElem=null;this.dragObject={};this.onMouseDown=function(e){e=e||window.event;if(!e.target||e.which!=1||!_this.options.selector(e.target)||_this.options.finished){return}
dragElem=e.target;_this.dragObject.elem=dragElem;_this.dragObject.className=dragElem.className;_this.dragObject.coordX=e.pageX;_this.dragObject.coordY=e.pageY;};this.onMouseMove=function(e){e=e||window.event;if(!_this.dragObject.elem){return}
if(!_this.dragObject.avatar){var moveX=e.pageX-_this.dragObject.coordX;var moveY=e.pageY-_this.dragObject.coordY;if(Math.abs(moveX)<3&&Math.abs(moveY)<3){return}
_this.dragObject.avatar=createAvatar(e);if(!_this.dragObject.avatar){return}
var elemCoords=getCoords(_this.dragObject.avatar);_this.dragObject.shiftX=_this.dragObject.coordX-elemCoords.left;_this.dragObject.shiftY=_this.dragObject.coordY-elemCoords.top;startDrag(e);}
_this.dragObject.avatar.style.left=e.pageX-_this.dragObject.shiftX+'px';_this.dragObject.avatar.style.top=e.pageY-_this.dragObject.shiftY+'px';return false;};function createAvatar(e){var avatar=_this.dragObject.elem;var old={parent:avatar.parentNode,nextSibling:avatar.nextSibling,position:avatar.position||'',left:avatar.left||'',top:avatar.top||'',zIndex:avatar.zIndex||''};avatar.rollBack=function(){old.parent.insertBefore(avatar,old.nextSibling);avatar.style.position=old.position;avatar.style.left=old.top;avatar.style.top=old.top;avatar.style.zIndex=old.zIndex};return avatar;}
function getCoords(elem){var box=elem.getBoundingClientRect();return{left:box.left+pageXOffset,top:box.top+pageYOffset}}
function startDrag(e){var avatar=_this.dragObject.avatar;document.body.appendChild(avatar);avatar.style.zIndex='100';avatar.style.position='absolute';}
this.onMouseUp=function(e){e=e||window.event;if(_this.dragObject.avatar){finishDrag(e);}
_this.dragObject={};};function finishDrag(e){var dropElem=findDroppable(e);_this.checkAnswer(dragElem,dropElem)}
function findDroppable(e){var centerCoords=getCenterCoords(_this.dragObject.avatar);_this.dragObject.avatar.style.display='none';var dropElem=document.elementFromPoint(centerCoords.left,centerCoords.top);_this.dragObject.avatar.style.display='inline-block';if(dropElem===null){return null;}
return dropElem;}
function getCenterCoords(elem){var box=elem.getBoundingClientRect();return{left:box.left+(box.right-box.left)/2+pageXOffset,top:box.top+(box.bottom-box.top)/2+pageYOffset}}});mainApp.controller('soundsCtrl',function(GameSounds){var rightSound=document.getElementById('rightSound');var errorSound=document.getElementById('errorSound');var winnerSound=document.getElementById('winnerSound');var gameOverSound=document.getElementById('gameOverSound');GameSounds.defineRightSound(rightSound);GameSounds.defineErrorSound(errorSound);GameSounds.defineWinnerSound(winnerSound);GameSounds.defineGameOverSound(gameOverSound);});mainApp.directive('clickpuzzle',function(){return{restrict:'E',templateUrl:'/games/ClickPuzzle/views/ClickPuzzleMainView.html',controller:'ClickPuzzle',controllerAs:'cp'}});'use strict';mainApp.controller('ClickPuzzle',function($scope,RandomIndexes,GameSounds){var _this=this;var rand,position;this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.outline='0.2em solid #606060';this.cellWidth=500/$scope.ageSettings.level+'px';this.cellsPositions=[];for(var i=0;i<$scope.ageSettings.level;i++){for(var j=0;j<$scope.ageSettings.level;j++){rand=RandomIndexes.randInteger(0,$scope.ageSettings.level-1);position=-rand*500/$scope.ageSettings.level+'px'+' '+-i*500/$scope.ageSettings.level+'px';_this.cellsPositions.push(position);}}
this.shiftCell=function(index){if(_this.outline==='none'){return}
var currentPosition=_this.cellsPositions[index];var x=+currentPosition.split('px ')[0];var shift=x-500/$scope.ageSettings.level;if(shift===-500){x='0px ';}else{x=shift+'px ';}
var y=currentPosition.split(' ')[1];var newPosition=x+y;_this.cellsPositions[index]=newPosition;checkIsFinished();};function checkIsFinished(){var pos;for(var i=0,j=0;i<$scope.ageSettings.level*$scope.ageSettings.level;i++){if(j===$scope.ageSettings.level){j=0;}
pos=+_this.cellsPositions[i].split('px ')[0];if(pos!==-j*500/$scope.ageSettings.level){return false}
j++;}
GameSounds.playWinnerSound();_this.outline='none';}});mainApp.directive('counthowmuch',function(){return{restrict:'E',templateUrl:'/games/CountHowMuch/views/CountHowMuchMainView.html',controller:'CountHowMuch',controllerAs:'cm'}});'use strict';mainApp.controller('CountHowMuch',function($scope,RandomIndexes,GameSounds,DragManager){var _this=this;var errors=0;var rights=0;this.finished=false;this.bg='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'bg.svg)';this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';this.level=$scope.ageSettings.level;this.coords=$scope.themeSettings.coords.sort(RandomIndexes.compareRandom);var answerPicsRandIndexes=RandomIndexes.buildIndexes(0,8,this.level);this.answerPicsRandPositions=answerPicsRandIndexes.map(function(index){return-index*65+'px'+' 0px'});this.randItems={positions:[],top:[],left:[]};var rand;for(var i=0;i<this.level;i++){rand=RandomIndexes.randInteger(1,5);for(var j=0;j<rand;j++){_this.randItems.positions.push(_this.answerPicsRandPositions[i])}}
for(var k=0;k<_this.randItems.positions.length;k++){_this.randItems.left.push(_this.coords[k].left);_this.randItems.top.push(_this.coords[k].top);}
document.onmousedown=DragManager.onMouseDown;document.onmousemove=DragManager.onMouseMove;document.onmouseup=DragManager.onMouseUp;document.ondragstart=function(){return false};DragManager.options={selector:function(elem){return elem.parentNode.className==='count-how-much-digits-container';},finished:false};DragManager.checkAnswer=function(dragElem,dropElem){var picToCountPosition=dropElem.parentNode.getElementsByClassName('count-how-much-pic-to-count')[0].style.backgroundPosition;var elemsNumber=checkAllPositions(picToCountPosition,_this.randItems.positions);if(dropElem.className==='count-how-much-question'&&elemsNumber==dragElem.textContent){rights++;dropElem.textContent=dragElem.textContent;if(rights===_this.level){GameSounds.playWinnerSound();DragManager.options.finished=_this.finished=true;}else{GameSounds.playRightSound()}}else{errors++;if(errors===2){GameSounds.playGameOverSound();DragManager.options.finished=_this.finished=true;}else{GameSounds.playErrorSound();}}
DragManager.dragObject.avatar.rollBack();};function checkAllPositions(elem,arr){var elemsNumber=0;var index=arr.indexOf(elem);for(var i=0;i<arr.length;i++){if(arr[i]===elem){elemsNumber++}}
return elemsNumber;}});mainApp.directive('crosswords',function(){return{restrict:'E',templateUrl:'/games/Crosswords/views/CrosswordsMainView.html',controller:'Crosswords',controllerAs:'cr'}});'use strict';mainApp.controller('Crosswords',function($scope,RandomIndexes,GameSounds){});mainApp.directive('findaccordance',function(){return{restrict:'E',templateUrl:'/games/FindAccordance/views/FindAccordanceMainView.html',controller:'FindAccordance',controllerAs:'fa'}});'use strict';mainApp.controller('FindAccordance',function($scope,RandomIndexes,GameSounds){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'centerImg.png)';this.items='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';var centerImgIndex=0;var errors=0;var _this=this;this.finished=false;var centerImgIndexes=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems);var itemsIndexes=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems);this.centerImgPositions=centerImgIndexes.map(function(item){return-item*200+'px'+' 0px'});this.currentCenterImgArr=new Array($scope.themeSettings.numberOfItems);this.currentCenterImgArr[centerImgIndex]=1;var x0=200;var y0=200;var angle=0;var radius=200;this.itemsPositions=itemsIndexes.map(function(item){angle+=Math.PI/($scope.themeSettings.numberOfItems/2);return{'position':-item*100+'px'+' 0px','top':y0+radius*Math.sin(angle)+'px','left':x0+radius*Math.cos(angle)+'px'}});this.checkAnswer=function(index){if(itemsIndexes[index]===centerImgIndexes[centerImgIndex]){_this.currentCenterImgArr[centerImgIndex]=0;centerImgIndex++;if(centerImgIndex===$scope.themeSettings.numberOfItems){GameSounds.playWinnerSound();_this.finished=true;$scope.winnerCup=true;$scope.winnerText='Молодец!!!';}else{_this.currentCenterImgArr[centerImgIndex]=1;GameSounds.playRightSound();}}else{errors++;if(errors===2){GameSounds.playGameOverSound();_this.finished=true;$scope.winnerCup=false;$scope.winnerText='Попробуй ещё раз';}else{GameSounds.playErrorSound()}}}});mainApp.directive('finddifferences',function(){return{restrict:'E',templateUrl:'/games/FindDifferences/views/FindDifferencesMainView.html',controller:'FindDifferences',controllerAs:'fd'}});'use strict';mainApp.controller('FindDifferences',function($scope,GameSounds){var errors=0;var _this=this;this.finished=false;this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.picturesBgPositions=['0px 0px','-400px 0px'];this.diffs=$scope.themeSettings.diffs;angular.forEach(this.diffs,function(diff){if(diff['border']){delete diff['border'];delete diff['borderRadius'];diff.imgTop+=5;diff.imgLeft+=5;diff.imgWidth-=10;diff.imgHeight-=10;}});var clickedDiffs=[];this.checkDifference=function(e,d,index){e.stopPropagation();if(clickedDiffs.indexOf(index)===-1){clickedDiffs.push(index);d.imgTop-=5;d.imgLeft-=5;d.imgWidth+=10;d.imgHeight+=10;d.border='0.25em solid red';d.borderRadius='35px';if(clickedDiffs.length===5){_this.finished=true;$scope.winnerCup=true;$scope.winnerText='Молодец!!!';GameSounds.playWinnerSound();}else{GameSounds.playRightSound();}}};this.errorClick=function(){errors++;if(errors===2){_this.finished=true;$scope.winnerCup=false;GameSounds.playGameOverSound();}else{GameSounds.playErrorSound();}};});mainApp.directive('findshadow',function(){return{restrict:'E',templateUrl:'/games/FindShadow/views/FindShadowMainView.html',controller:'FindShadow',controllerAs:'fs'}});'use strict';mainApp.controller('FindShadow',function($scope,RandomIndexes,GameSounds){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';this.finished=false;var picIndex=-1;var errors=0;var _this=this;this.originPicsIndexes=RandomIndexes.buildIndexes(0,8,$scope.ageSettings.level);this.shadowedPicsIndexes=RandomIndexes.buildIndexes(0,8);this.originPicsPositions=this.originPicsIndexes.map(function(item){return-item*100/7+'%'+' 0%';});this.shadowedPicsPositions=this.shadowedPicsIndexes.map(function(item){return-item*100/7+'%'+' 0%';});this.isActiveArr=new Array($scope.ageSettings.level);changeActivePicture();this.checkAnswer=function(item){if(item===_this.originPicsIndexes[picIndex]){changeActivePicture();if(picIndex===$scope.ageSettings.level){GameSounds.playWinnerSound();$scope.winnerText='Молодец!!!';$scope.winnerCup=true;_this.finished=true;}else{GameSounds.playRightSound();}}else{errors++;if(errors===2){GameSounds.playGameOverSound();_this.finished=true;$scope.winnerCup=false;$scope.winnerText='Попробуй ещё раз';}else{GameSounds.playErrorSound();}}};function changeActivePicture(){_this.isActiveArr[picIndex]='';picIndex++;_this.isActiveArr[picIndex]='find-shadow-active-picture';}});mainApp.directive('findthehalf',function(){return{restrict:'E',templateUrl:'/games/FindTheHalf/views/FindTheHalfMainView.html',controller:'FindTheHalf',controllerAs:'fh'}});'use strict';mainApp.controller('FindTheHalf',function($scope,$interval,RandomIndexes,GameSounds,DragManager){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';this.finished=false;var level=$scope.ageSettings.level;var _this=this;var errors=0;var rights=0;this.answersPositions=[];var halfIndexes1=RandomIndexes.buildIndexes(0,8,level);var halfIndexes2=halfIndexes1.map(function(index){return index+0.5});var indexes=halfIndexes1.concat(halfIndexes2);this.randPositions=indexes.map(function(index){return-index*150+'px'+' 0px'});this.randPositions.sort(RandomIndexes.compareRandom);if(level===8){this.degrees=indexes.map(function(){return'rotate('+RandomIndexes.randInteger(0,180)+'deg)';})}else{this.degrees=indexes.map(function(){return'rotate(0deg)';})}
document.onmousedown=DragManager.onMouseDown;document.onmousemove=DragManager.onMouseMove;document.onmouseup=DragManager.onMouseUp;document.ondragstart=function(){return false};DragManager.options={selector:function(elem){if(elem.className==='find-the-half-single-img ng-scope'){return true}else{return false}},finished:false};DragManager.checkAnswer=function(dragObj,dropObj){var bigger;var dragObjPosition=dragObj.style.backgroundPosition.split('px ')[0];var dropObjPosition=dropObj.style.backgroundPosition.split('px ')[0];bigger=defineBiggerPosition(dragObjPosition,dropObjPosition);if(((bigger.diff===75||bigger.diff===-75)&&bigger.odd===0)&&dropObj.className==='find-the-half-single-img ng-scope'){addAnswer(dragObj,dropObj,bigger.position);}else{errors++;if(errors===2){GameSounds.playGameOverSound();_this.randPositions.splice(_this.randPositions.indexOf(dragObj.style.backgroundPosition),1);$scope.$apply(_this.randPositions);DragManager.options.finished=true;_this.finished=true;$scope.$apply(_this.finished);$scope.winnerCup=false;}else{DragManager.dragObject.avatar.rollBack();GameSounds.playErrorSound()}}};function defineBiggerPosition(a,b){var obj={};obj.diff=a-b;if(obj.diff>0){obj.odd=a%2;obj.position=a;}else{obj.odd=b%2;obj.position=b;}
return obj;}
function addAnswer(dragObj,dropObj,position){rights++;_this.randPositions.splice(_this.randPositions.indexOf(dragObj.style.backgroundPosition),1);_this.randPositions.splice(_this.randPositions.indexOf(dropObj.style.backgroundPosition),1);position=position+'px'+' 0px';_this.answersPositions.push(position);$scope.$apply(_this.answersPositions);if(rights===level){GameSounds.playWinnerSound();DragManager.options.finished=true;_this.finished=true;$scope.$apply(_this.finished);$scope.winnerCup=true;}else{GameSounds.playRightSound();}}});mainApp.directive('findthepair',function(){return{restrict:'E',templateUrl:'/games/FindThePair/views/FindThePairMainView.html',controller:'FindThePair',controllerAs:'fp'}});'use strict';mainApp.controller('FindThePair',function($scope,$timeout,RandomIndexes,GameSounds){var pic1,pic2,cover1,cover2;var flag=0,openPairs=0;var _this=this;var level=$scope.ageSettings.level;switch(level){case 8:this.topOffset='20px';break;case 6:this.topOffset='40px';break;case 4:this.topOffset='80px';break;}
this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';this.positions=[];this.finished=false;var arr=RandomIndexes.buildIndexes(0,8,level);this.arr=RandomIndexes.makeDouble(arr);for(var i=0;i<level*2;i++){this.positions.push(-8*this.arr[i]+'em'+' 0em');}
this.showPicture=function(e,pic){if(e.target===cover1||flag===2){return}
if(!pic1){flag=1;cover1=e.target;cover1.style.opacity=0;pic1=pic;}else{flag=2;cover2=e.target;cover2.style.opacity=0;pic2=pic;if(pic1!==pic2){closePicturesAfterTime();}else{openPairs++;GameSounds.playRightSound();if(openPairs===level){finishGame();}else{flag=0;}}
pic1='';pic2='';}};function closePicturesAfterTime(){$timeout(function(){cover1.style.opacity=1;cover2.style.opacity=1;flag=0;},$scope.ageSettings.timeToClosePicture);}
function finishGame(){$timeout(function(){_this.finished=true;$scope.winnerCup=true;$scope.winnerText="Молодец!!!";GameSounds.playWinnerSound();},500);}});mainApp.directive('findthesame',function(){return{restrict:'E',templateUrl:'/games/FindTheSame/views/FindTheSameMainView.html',controller:'FindTheSame',controllerAs:'fs'}});'use strict';mainApp.controller('FindTheSame',function($scope,RandomIndexes,GameSounds){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.svg)';var _this=this;var clicks=0;var tempItem='';var tempIndex;var round=0;var level=$scope.ageSettings.level;if(level!==4){this.width='468px'}else{this.width='312px'}
this.arrOfChecked=new Array(level);this.finished=false;this.checkItem=function(item,index){clicks++;if(clicks===1){tempItem=item;tempIndex=index;_this.arrOfChecked[tempIndex]='#0065FF';}
if(clicks===2){if(tempIndex===index){reset();return;}
if(tempItem===item){round++;if(round===6){_this.finished=true;GameSounds.playWinnerSound();$scope.winnerCup=true;$scope.winnerText='Молодец!!!';}else{GameSounds.playRightSound();}
buildItems()}
reset();}};function reset(){tempItem='';clicks=0;_this.arrOfChecked[tempIndex]='';};function buildItems(){if(_this.finished){return}
var randIndexes=RandomIndexes.buildIndexes(0,8,level-1);var indexOfItems=RandomIndexes.buildIndexes(0,randIndexes.length)[0];var indexToFind=randIndexes[indexOfItems];randIndexes.push(indexToFind);var itemsPositions=randIndexes.map(function(item){return-item*150+'px'+' 0px'});_this.itemsPositionsRand=itemsPositions.slice();_this.itemsPositionsRand.sort(RandomIndexes.compareRandom);}
buildItems();});mainApp.directive('findwordsintable',function(){return{restrict:'E',templateUrl:'/games/FindWordsInTable/views/FindWordsInTableMainView.html',controller:'FindWordsInTable',controllerAs:'fw'}});'use strict';mainApp.controller('FindWordsInTable',function($scope,RandomIndexes,GameSounds){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';var items=$scope.themeSettings.items;var minChar=1040;var maxChar=1071;var randStr='';var str='';var arr;var clickedItem='';var foundItemIndex;var itemIndexInRow;var clickedRows=[];this.clickedLettersArr=new Array(12);this.clickedArr=new Array(12);this.shadowedArr=new Array(12);for(var i=0;i<12;i++){this.clickedLettersArr[i]=new Array(8);this.clickedArr[i]=new Array(8);this.shadowedArr[i]=new Array(8);}
var _this=this;var randPicsIndexes=RandomIndexes.buildIndexes(0,8);this.randItems=[];for(var i=0;i<8;i++){this.randItems[i]=items[randPicsIndexes[i]]}
this.showTickArr=new Array(8);this.randPicsPositions=randPicsIndexes.map(function(item){return-150*item+'px'+' 0px'});var rows=items.map(function(item){str=buildRandString(item);arr=str.split('');arr.splice(defineRandSymbol(0,item.length),0,item);str=arr.join('');return str;});this.randRows=rows.slice();this.randRows.sort(RandomIndexes.compareRandom);function buildRandString(elem){randStr='';for(var i=0;i<12-elem.length;i++){randStr+=String.fromCharCode(defineRandSymbol(minChar,maxChar))}
return randStr;}
function defineRandSymbol(min,max){var rand;rand=min+Math.random()*(max+1-min);rand=Math.floor(rand);return rand;};this.chooseLetter=function(char,e,parentIndex,index){if(clickedRows.indexOf(parentIndex)!==-1){return}
_this.clickedArr[parentIndex][index]=!_this.clickedArr[parentIndex][index];if(_this.clickedLettersArr[parentIndex][index]===char){_this.clickedLettersArr[parentIndex][index]=''}else{_this.clickedLettersArr[parentIndex][index]=char;}
clickedItem=_this.clickedLettersArr[parentIndex].join('');foundItemIndex=_this.randItems.indexOf(clickedItem);if(foundItemIndex!==-1){_this.showTickArr[foundItemIndex]=1;clickedRows.push(parentIndex);for(var i=0;i<_this.randRows.length;i++){if(_this.randRows[i].indexOf(clickedItem)!==-1){itemIndexInRow=_this.randRows[i].indexOf(clickedItem)}}
for(var i=0;i<12;i++){if(i<itemIndexInRow||i>itemIndexInRow+clickedItem.length-1){_this.shadowedArr[parentIndex][i]=1}}
if(clickedRows.length===8){GameSounds.playWinnerSound()}else{GameSounds.playRightSound()}}};});mainApp.directive('lookatthepictureandanswer',function(){return{restrict:'E',templateUrl:'/games/LookAtThePictureAndAnswer/views/LookAtThePictureAndAnswerMainView.html',controller:'LookAtThePicture',controllerAs:'lp'}});'use strict';mainApp.controller('LookAtThePicture',function($scope,$timeout,GameSounds){var _this=this;var errors=0;var scope=$scope;scope.time=20000;this.showPicture=true;this.current=0;scope.faces=[];this.arr=[1,0,0,0,0];this.picture='/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.jpg';this.finished=false;$timeout(function(){_this.showPicture=false;},scope.time);this.checkAnswer=function(answer){if(answer===$scope.themeSettings.answers[_this.current]){scope.faces.push(1);GameSounds.playRightSound();}else{scope.faces.push(0);errors++;GameSounds.playErrorSound();}
nextQuestion();};function nextQuestion(){_this.arr[_this.current]=0;_this.current++;if(_this.current===5){finishGame();}else{_this.arr[_this.current]=1;}}
function finishGame(){_this.finished=true;if(!errors){$scope.winnerCup=true;GameSounds.playWinnerSound();}else{$scope.winnerCup=false;GameSounds.playGameOverSound();}}
this.checkVariantsType=function(elem){if(elem[0][0]==='r'||elem[0][0]==='#'){return{'display':'inline-block','width':'100px','height':'100px','margin':'10px','border-radius':'50%','background-color':elem,'font-size':'0','cursor':'pointer'}}else{return{'display':'inline-block','min-width':'100px','margin':'10px','padding':'10px','text-align':'center','cursor':'pointer','border-radius':'4px','background-color':'#fff','box-shadow':'0 0 5px #000'}}};});mainApp.directive('memorypainter',function(){return{restrict:'E',templateUrl:'/games/MemoryPainter/views/MemoryPainterMainView.html',controller:'MemoryPainter',controllerAs:'mp'}});mainApp.directive('mppic',function(){return{restrict:'E',templateUrl:'/games/MemoryPainter/views/MemoryPainterPic.html',scope:{pic:'='},controller:'mpPic',controllerAs:'mpc'}});mainApp.directive('palette',function(){return{restrict:'E',templateUrl:'/games/MemoryPainter/views/MemoryPainterPalette.html',scope:{items:'='},controller:'mpPalette',controllerAs:'mpp'}});'use strict';mainApp.controller('MemoryPainter',function($http,$scope,$interval){var _this=this;var interval=null;var pathElems=null;var pathesArr=[];this.showHeader=true;this.showChoosedPic=[];this.level=$scope.ageSettings.level;$scope.$on('choosedIndex',function(e,index){for(var i=0;i<_this.pics.length;i++){if(i!==index){_this.showChoosedPic[i]=0}}
_this.showHeader=false;$scope.time=$scope.ageSettings.timeToShowPicture;$scope.$broadcast('timeToShowPicture',$scope.time);$scope.$broadcast('showProgressBar',true);});$scope.$on('palette',function(e,items){_this.paletteItems=items;$scope.$broadcast('showProgressBar',false);});$scope.$on('grubedColor',function(e,color){$scope.$broadcast('grubed',color);});$http.get('/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.json').success(function(data){_this.pics=data;pathElems=document.getElementsByTagName('path');interval=$interval(function(){if(pathElems.length){$interval.cancel(interval);angular.forEach(_this.pics,function(item,i){for(var key in item.picture){if(item.age.indexOf(_this.level)!==-1){pathesArr.push(item.picture[key].d);}}});if(pathesArr.length){angular.forEach(pathElems,function(elem,i){elem.setAttribute('d',pathesArr[i])});for(var i=0;i<_this.pics.length;i++){_this.showChoosedPic[i]=1}}}},20);});});mainApp.controller('mpPic',function($scope,$timeout,RandomIndexes,GameSounds){var _this=this;this.choosedPic=[];this.picScale=0.5;this.choosed=false;this.paletteItems=['#E30513','#F9B233','#FFED00','#009640','#009EE3','#302683','#662382','#FFFFFF','#000000'];var canColorize=false;var pathesArr;var cursorField=document.getElementsByTagName('memorypainter')[0];this.finished=false;$scope.$on('timeToShowPicture',function(e,timeToShowPicture){_this.timeToShowPicture=timeToShowPicture;});$scope.$on('grubed',function(e,color){_this.grubedColor=color;});this.choosePic=function(i,pic){if(_this.choosed){return}
_this.choosed=true;var svg=document.getElementsByTagName('svg')[i];var pathes=svg.getElementsByTagName('path');pathesArr=Array.prototype.slice.call(pathes);angular.forEach(pathes,function(elem,index){elem.setAttribute('fill',pic[index].fill);if(_this.paletteItems.indexOf(pic[index].fill)===-1){_this.paletteItems.push(pic[index].fill)}});_this.paletteItems.sort(RandomIndexes.compareRandom);$scope.$emit('choosedIndex',i);_this.choosedPic[i]=1;_this.picScale=1;$timeout(function(){angular.forEach(pathes,function(elem,index){if(pic[index].discolor!==false){elem.setAttribute('fill','#ffffff')}});$scope.$emit('palette',_this.paletteItems);$scope.$emit('showProgressBar',false);cursorField.style.cursor='url(/games/MemoryPainter/brushes/brush.svg), auto';var svgs=cursorField.getElementsByTagName('svg');angular.forEach(svgs,function(svg){svg.style.cursor='inherit';});canColorize=true;},_this.timeToShowPicture)};this.fillShape=function(e,discolor,shapes){if(!_this.choosed||!canColorize||discolor===false){return}
e.target.setAttribute('fill',_this.grubedColor);_this.finished=pathesArr.every(function(elem,i){return elem.getAttribute('fill')===shapes[i].fill});if(_this.finished){canColorize=false;GameSounds.playWinnerSound()}}});mainApp.controller('mpPalette',function($scope){var _this=this;var cursorField=document.getElementsByTagName('memorypainter')[0];this.grubColor=function(item){$scope.$emit('grubedColor',item);cursorField.style.cursor='url(/games/MemoryPainter/brushes/'+item.substring(1)+'.svg), auto';};});mainApp.directive('noisedpictures',function(){return{restrict:'E',templateUrl:'/games/NoisedPictures/views/NoisedPicturesMainView.html',controller:'NoisedPictures',controllerAs:'np'}});'use strict';mainApp.controller('NoisedPictures',function($scope,GameSounds,RandomIndexes){var _this=this;_this.finished=false;var picsFound=0;var errors=0;this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';this.noisedPicture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.svg)';var picIndexes=RandomIndexes.buildIndexes(0,8);var noisedPicIndexes=RandomIndexes.buildIndexes(0,8,$scope.ageSettings.level);this.picPositions=picIndexes.map(function(item){return-item*100+'px'+' 0px';});this.noisedPicPositions=noisedPicIndexes.map(function(item){return-item*400+'px'+' 0px';});this.foundPicsArr=new Array($scope.ageSettings.level);this.checkAnswer=function(item){var clickedIndex=picIndexes[_this.picPositions.indexOf(item)];if(noisedPicIndexes.indexOf(clickedIndex)!==-1){picsFound++;if(picsFound===$scope.ageSettings.level){GameSounds.playWinnerSound();$scope.winnerText='Молодец!!!';_this.finished=true;}else{GameSounds.playRightSound();}
_this.foundPicsArr[noisedPicIndexes.indexOf(clickedIndex)]='found-pic';}else{errors++;if(errors==2){GameSounds.playGameOverSound();$scope.winnerCup=false;$scope.winnerText='Попробуй ещё раз!';_this.finished=true;}else{GameSounds.playErrorSound()}}}});mainApp.directive('rotateanimal',function(){return{restrict:'E',templateUrl:'/games/RotateAnimal/views/RotateAnimalMainView.html',controller:'RotateAnimal',controllerAs:'ra'}});'use strict';mainApp.controller('RotateAnimal',function($scope,$timeout,GameSounds,RandomIndexes){var _this=this;var randIndexes=RandomIndexes.buildIndexes(0,25);this.itemSettings=randIndexes.map(function(item){if(Math.random()>0.5){return{angle:'rotate('+180+'deg)',position:-90*item+'px'+' 0px'}}else{return{angle:'rotate('+0+'deg)',position:-90*item+'px'+' 0px'}}});this.rotateCell=function(item){if(this.finished){return;}
var index=this.itemSettings.indexOf(item);this.makeRotation(item,index);this.rotateNeighbors(item,index);this.finished=isAllItemsRotated();};this.makeRotation=function(item,index){if(!this.itemSettings[index]){return;}
if(item.angle==='rotate(0deg)'){this.itemSettings[index].angle='rotate(180deg)';}else{this.itemSettings[index].angle='rotate(0deg)';}};this.rotateNeighbors=function(item,index){switch($scope.ageSettings.level){case 0:break;case 2:if((index+1)%5!==0){this.makeRotation(this.itemSettings[index+1],index+1);}
this.makeRotation(this.itemSettings[index+5],index+5);break;case 4:this.makeRotation(this.itemSettings[index+5],index+5);this.makeRotation(this.itemSettings[index-5],index-5);if((index+1)%5!==0){this.makeRotation(this.itemSettings[index+1],index+1);}
if(index%5!==0){this.makeRotation(this.itemSettings[index-1],index-1);}
break;}};function isAllItemsRotated(){for(var i=0;i<_this.itemSettings.length;i++){if(_this.itemSettings[i].angle==='rotate(180deg)'){return false;}}
GameSounds.playWinnerSound();return true;}});mainApp.directive('sortpictures',function(){return{restrict:'E',templateUrl:'/games/SortPictures/views/SortPicturesMainView.html',controller:'SortPictures',controllerAs:'sp'}});'use strict';mainApp.controller('SortPictures',function($scope,GameSounds,RandomIndexes,DragManager){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.finished=false;$scope.winnerText='';var _this=this;var randIndexes=RandomIndexes.buildIndexes(0,4);var errors=0;var rights=0;this.randPositions=randIndexes.map(function(index){return-index*150+'px'+' 0px'});document.onmousedown=DragManager.onMouseDown;document.onmousemove=DragManager.onMouseMove;document.onmouseup=DragManager.onMouseUp;DragManager.options={selector:function(elem){return elem.className==='sort-pictures-task-picture ng-scope'&&elem.parentNode.className!=='sort-pictures-img-container';},finished:false};DragManager.checkAnswer=function(dragElem,dropElem){var dropElems=document.querySelectorAll('.sort-pictures-img-container');var dropElemsArr=Array.prototype.slice.call(dropElems);if(dropElem.className==='sort-pictures-img-container'&&dropElemsArr.indexOf(dropElem)===dragElem.style.backgroundPosition.split('px ')[0]/-150){dragElem.style.position='initial';dragElem.style.margin=0;dropElem.appendChild(dragElem);rights++;if(rights===4){GameSounds.playWinnerSound();_this.finished=true;$scope.winnerText="Молодец!!!";$scope.$apply($scope.winnerText);}else{GameSounds.playRightSound();}}else{errors++;DragManager.dragObject.avatar.rollBack();if(errors===2){GameSounds.playGameOverSound();_this.finished=true;DragManager.options.finished=true;$scope.winnerText="Попробуй ещё раз";$scope.$apply();}else{GameSounds.playErrorSound();}}}});mainApp.directive('whatisforgot',function(){return{restrict:'E',templateUrl:'/games/WhatIsForgot/views/WhatIsForgotMainView.html',controller:'WhatIsForgot',controllerAs:'wf'}});'use strict';mainApp.controller('WhatIsForgot',function($scope,RandomIndexes,GameSounds){var _this=this;var errors=0;this.finished=false;this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.items='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[1]+')';this.itemsToChoose='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[2]+')';var itemsIndexes=[];this.itemsIndexesToShow=[];var elemToFindIndex=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems)[0];var itemsToChooseIndexes=[];for(var i=0;i<$scope.themeSettings.numberOfItems;i++){if(i!==elemToFindIndex){_this.itemsIndexesToShow.push(1)}else{_this.itemsIndexesToShow.push(0)}
itemsIndexes.push(i)}
this.itemsPositions=itemsIndexes.map(function(item){return-item*400+'px'+' 0px'});for(var j=0;j<8;j++){itemsToChooseIndexes.push(j)}
var itemsToChoosePositions=itemsToChooseIndexes.map(function(item){return-item*100+'px'+' 0px'});this.itemsToChoosePositionsRand=itemsToChoosePositions.slice();this.itemsToChoosePositionsRand.sort(RandomIndexes.compareRandom);this.checkAnswer=function(item){if(_this.finished){return}
if(itemsToChoosePositions.indexOf(item)===elemToFindIndex){_this.itemsIndexesToShow[elemToFindIndex]=1;GameSounds.playWinnerSound();$scope.winnerText='Молодец!!!';_this.finished=true;}else{errors++;if(errors===2){GameSounds.playGameOverSound();$scope.winnerText='Попробуй ещё раз';_this.finished=true;}else{GameSounds.playErrorSound();}}}});mainApp.directive('whatisunwanted',function(){return{restrict:'E',templateUrl:'/games/WhatIsUnwanted/views/WhatIsUnwantedMainView.html',controller:'WhatIsUnwanted',controllerAs:'wu'}});'use strict';mainApp.controller('WhatIsUnwanted',function($scope,RandomIndexes,GameSounds,$interval){this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';var _this=this;this.finished=false;var numberOfItems=$scope.themeSettings.numberOfItems;var elemToFindIndex,randIndexes;var level=$scope.ageSettings.level;$scope.faces=[];this.finished=false;this.containerWidth=(level+1)*150+60+'px';function buildElems(){elemToFindIndex=RandomIndexes.buildIndexes(0,numberOfItems*2)[0];if(elemToFindIndex<numberOfItems){randIndexes=RandomIndexes.buildIndexes(numberOfItems,numberOfItems*2,level);}else{randIndexes=RandomIndexes.buildIndexes(0,numberOfItems,level);}
randIndexes.push(elemToFindIndex);_this.itemsPositions=randIndexes.map(function(item){return-item*150+'px'+' 0px'});_this.itemsPositionsRand=_this.itemsPositions.slice();_this.itemsPositionsRand.sort(RandomIndexes.compareRandom);}
buildElems();this.checkAnswer=function(item){if(_this.finished){return}
if(item===_this.itemsPositions.slice(-1)[0]){$scope.faces.push(1);checkIsFinished(GameSounds.playRightSound);}else{$scope.faces.push(0);checkIsFinished(GameSounds.playErrorSound);}};function checkIsFinished(sound){if($scope.faces.length===5){_this.finished=true;if($scope.faces.indexOf(0)===-1){GameSounds.playWinnerSound();$scope.winnerCup=true;$scope.winnerText='Молодец!!!';}else{GameSounds.playGameOverSound();$scope.winnerCup=false;$scope.winnerText='Попробуй ещё раз';}
_this.finished=true;}else{sound();buildElems();}}});mainApp.directive('whattimeisit',function(){return{restrict:'E',templateUrl:'/games/WhatTimeIsIt/views/WhatTimeIsItMainView.html',controller:'WhatTimeIsIt',controllerAs:'wt'}});'use strict';mainApp.controller('WhatTimeIsIt',function($scope,$timeout,GameSounds){});mainApp.directive('whereitgrows',function(){return{restrict:'E',templateUrl:'/games/WhereItGrows/views/WhereItGrowsMainView.html',controller:'WhereItGrows',controllerAs:'wg'}});'use strict';mainApp.controller('WhereItGrows',function($scope,$timeout,GameSounds,RandomIndexes,DragManager){var _this=this;this.bg='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'bg.svg)';this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+'items.png)';var level=$scope.ageSettings.level;var rights=0;var errors=0;var randIndexes1=RandomIndexes.buildIndexes(0,8,level);var randPositions1=randIndexes1.map(function(index){return-index*100+'px'+' 0px'});var randIndexes2=RandomIndexes.buildIndexes(8,16,level);var randPositions2=randIndexes2.map(function(index){return-index*100+'px'+' 0px'});this.randPositions=randPositions1.concat(randPositions2);this.randPositions.sort(RandomIndexes.compareRandom);this.leftBasketElemsPositions=[];this.leftBasketCoords=$scope.themeSettings.coords.slice(0,level);this.rightBasketElemsPositions=[];this.rightBasketCoords=$scope.themeSettings.coords.slice(8,level+8);document.onmousedown=DragManager.onMouseDown;document.onmousemove=DragManager.onMouseMove;document.onmouseup=DragManager.onMouseUp;document.ondragstart=function(){return false};DragManager.options={selector:function(elem){return elem.className==='where-it-grows-item ng-scope';},finished:false};DragManager.checkAnswer=function(dragElem,dropElem){if(dragElem&&dropElem&&randPositions1.indexOf(dragElem.style.backgroundPosition)!==-1&&dropElem.style.backgroundPosition==='0px 0px'){addItem(dragElem,_this.leftBasketElemsPositions);}else if(dragElem&&dropElem&&randPositions2.indexOf(dragElem.style.backgroundPosition)!==-1&&dropElem.style.backgroundPosition==='400px 0px'){addItem(dragElem,_this.rightBasketElemsPositions);}else{DragManager.dragObject.avatar.rollBack();errors++;if(errors===2){GameSounds.playGameOverSound();_this.finished=true;DragManager.options.finished=true;$scope.winnerCup=false;$scope.$apply(_this.finished);}else{GameSounds.playErrorSound();}}};function addItem(dragElem,basketElemsPositions){_this.randPositions.splice(_this.randPositions.indexOf(dragElem.style.backgroundPosition),1);$scope.$apply(_this.randPositions);basketElemsPositions.push(dragElem.style.backgroundPosition);$scope.$apply(basketElemsPositions);rights++;if(rights===level*2){GameSounds.playWinnerSound();_this.finished=true;DragManager.options.finished=true;$scope.winnerCup=true;$scope.$apply(_this.finished);}else{GameSounds.playRightSound();}}});mainApp.directive('whoappeared',function(){return{restrict:'E',templateUrl:'/games/WhoAppeared/views/WhoAppearedMainView.html',controller:'WhoAppeared',controllerAs:'wa'}});'use strict';mainApp.controller('WhoAppeared',function($scope,$timeout,GameSounds,RandomIndexes){this.bg='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.items='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[1]+')';this.itemsCoords=$scope.themeSettings.itemsCoords;this.showItemsArr=[];this.showItemsToCheck=false;this.itemsCoords=$scope.themeSettings.itemsCoords;this.finished=false;$scope.time=10000;var _this=this;var errors=0;var randIndexes,randIndexes1,randIndexes2,picIndex,secretPicture,secretPicturePosition;this.itemsToCheck=new Array($scope.themeSettings.numberOfItems);function buildRandIndexes(){if($scope.themeSettings.randomize===true){randIndexes=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems,$scope.ageSettings.level);}else if($scope.themeSettings.randomize==='half'){randIndexes1=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems/2,$scope.ageSettings.level/2);randIndexes2=RandomIndexes.buildIndexes($scope.themeSettings.numberOfItems/2,$scope.themeSettings.numberOfItems,$scope.ageSettings.level/2);randIndexes=randIndexes1.concat(randIndexes2);}}
function buildItems(secretPicture){_this.itemsPositions=[];angular.forEach(randIndexes,function(elem,index){if(elem===secretPicture){_this.showItemsArr[index]=0;}else{_this.showItemsArr[index]=1;}
_this.itemsPositions.push(-elem*100+'px'+' 0px');});}
function definePicToFind(){buildRandIndexes();picIndex=RandomIndexes.buildIndexes(0,$scope.ageSettings.level-1,1)[0];secretPicture=randIndexes[picIndex];secretPicturePosition=-secretPicture*100+'px'+' 0px';buildItems(secretPicture);}
this.checkAnswer=function(e){if(e.currentTarget.style.backgroundPosition===secretPicturePosition){angular.forEach(randIndexes,function(elem,index){if(elem!==secretPicture){_this.showItemsArr[index]=0;}});GameSounds.playWinnerSound();_this.showItemsToCheck=false;}else{errors++;if(errors===2){GameSounds.playGameOverSound();_this.finished=true;}else{GameSounds.playErrorSound();}}};definePicToFind();$timeout(function(){angular.forEach(randIndexes,function(elem,index){_this.showItemsArr[index]=0;});$timeout(function(){if($scope.themeSettings.randomize===true){randIndexes.sort(RandomIndexes.compareRandom);}else if($scope.themeSettings.randomize==='half'){randIndexes1.sort(RandomIndexes.compareRandom);randIndexes2.sort(RandomIndexes.compareRandom);randIndexes=randIndexes1.concat(randIndexes2);}
buildItems();_this.showItemsToCheck=true;},2000);},10000);});mainApp.directive('whodisappeared',function(){return{restrict:'E',templateUrl:'/games/WhoDisappeared/views/WhoDisappearedMainView.html',controller:'WhoDisappeared',controllerAs:'wd'}});'use strict';mainApp.controller('WhoDisappeared',function($scope,$timeout,GameSounds,RandomIndexes){this.bg='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.items='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[1]+')';this.itemsCoords=$scope.themeSettings.itemsCoords;this.showItemsArr=[];this.showItemsToCheck=false;this.itemsCoords=$scope.themeSettings.itemsCoords;this.finished=false;$scope.time=10000;var _this=this;var errors=0;var randIndexes,randIndexes1,randIndexes2,picIndex,secretPicture,secretPicturePosition;this.itemsToCheck=new Array($scope.themeSettings.numberOfItems);function buildRandIndexes(){if($scope.themeSettings.randomize===true){randIndexes=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems,$scope.ageSettings.level);}else if($scope.themeSettings.randomize==='half'){randIndexes1=RandomIndexes.buildIndexes(0,$scope.themeSettings.numberOfItems/2,$scope.ageSettings.level/2);randIndexes2=RandomIndexes.buildIndexes($scope.themeSettings.numberOfItems/2,$scope.themeSettings.numberOfItems,$scope.ageSettings.level/2);randIndexes=randIndexes1.concat(randIndexes2);}}
function buildItems(secretPicture){_this.itemsPositions=[];angular.forEach(randIndexes,function(elem,index){if(elem===secretPicture){_this.showItemsArr[index]=0;}else{_this.showItemsArr[index]=1;}
_this.itemsPositions.push(-elem*100+'px'+' 0px');});}
function definePicToFind(){if($scope.themeSettings.randomize===true){randIndexes.sort(RandomIndexes.compareRandom);}else if($scope.themeSettings.randomize==='half'){randIndexes1.sort(RandomIndexes.compareRandom);randIndexes2.sort(RandomIndexes.compareRandom);randIndexes=randIndexes1.concat(randIndexes2);}
picIndex=RandomIndexes.buildIndexes(0,$scope.ageSettings.level-1,1)[0];secretPicture=randIndexes[picIndex];secretPicturePosition=-secretPicture*100+'px'+' 0px';$timeout(function(){buildItems(secretPicture);_this.showItemsToCheck=true;},2000)}
this.checkAnswer=function(e){if(e.currentTarget.style.backgroundPosition===secretPicturePosition){_this.showItemsArr[picIndex]=1;GameSounds.playWinnerSound();_this.showItemsToCheck=false;}else{errors++;if(errors===2){GameSounds.playGameOverSound();$scope.winnerCup=false;$scope.winnerText="Попробуй ещё раз!";_this.finished=true;}else{GameSounds.playErrorSound();}}};buildRandIndexes();buildItems();$timeout(function(){angular.forEach(randIndexes,function(elem,index){_this.showItemsArr[index]=0;});definePicToFind();},10000);});mainApp.directive('whosesound',function(){return{restrict:'E',templateUrl:'/games/WhoseSound/views/WhoseSoundMainView.html',controller:'WhoseSound',controllerAs:'ws'}});'use strict';mainApp.controller('WhoseSound',function($scope,$interval,GameSounds,RandomIndexes){var _this=this;var soundInterval=null;var currentSoundIndex=0;$scope.winnerText='';this.finished=false;this.items=$scope.themeSettings.items;var soundsPositions=RandomIndexes.buildIndexes(0,this.items.length);this.picture='url(/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/'+$scope.themeSettings.pictures[0]+')';this.soundsSrc='/games/img/'+$scope.themeSettings.id+'/'+$scope.id+'/sounds.mp3';this.sounds=document.getElementById('sounds');this.positions=[];this.rightAnswers=new Array(this.items.length);angular.forEach(this.items,function(elem,index){_this.positions.push(-index*150+'px'+' 0px');});this.sounds.addEventListener('canplaythrough',function(){_this.playSound=function(){_this.sounds.currentTime=this.items[soundsPositions[currentSoundIndex]].begin-0.2;_this.sounds.play();window.onblur=function(){$interval.cancel(soundInterval);_this.sounds.pause();};$interval.cancel(soundInterval);soundInterval=$interval(function(){if(_this.sounds.currentTime>_this.items[soundsPositions[currentSoundIndex]].end){_this.sounds.pause();$interval.cancel(soundInterval);}},300);};_this.checkAnswer=function(item){if(_this.finished){return false}
_this.sounds.pause();$interval.cancel(soundInterval);if(item.begin===_this.items[soundsPositions[currentSoundIndex]].begin){_this.rightAnswers[soundsPositions[currentSoundIndex]]=1;currentSoundIndex++;if(currentSoundIndex===_this.items.length){GameSounds.playWinnerSound();$scope.winnerText='Молодец!!!';_this.finished=true;}else{GameSounds.playRightSound();}}else{GameSounds.playErrorSound();}}},false);});